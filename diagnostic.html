<!DOCTYPE html>
<html>
<head>
    <title>API Connectivity Test</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        button { padding: 5px 10px; margin-right: 10px; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>API Connectivity Tests</h1>
    
    <div class="test">
        <h3>1. Backend on Port 5000</h3>
        <button onclick="testBackend(5000)">Test Connection</button>
        <button onclick="testApi(5000)">Test API POST</button>
        <div id="result5000"></div>
    </div>
    
    <div class="test">
        <h3>2. Backend on Port 5001</h3>
        <button onclick="testBackend(5001)">Test Connection</button>
        <button onclick="testApi(5001)">Test API POST</button>
        <div id="result5001"></div>
    </div>
    
    <div class="test">
        <h3>3. Browser Network Information</h3>
        <button onclick="getNetworkInfo()">Get Network Info</button>
        <div id="networkInfo"></div>
    </div>
    
    <script>
        async function testBackend(port) {
            const resultDiv = document.getElementById(`result${port}`);
            resultDiv.innerHTML = `<p>Testing connection to port ${port}...</p>`;
            
            try {
                const response = await fetch(`http://localhost:${port}/api/test`);
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML += `<p class="success">✓ Connection successful</p>`;
                    resultDiv.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    resultDiv.innerHTML += `<p class="error">✗ HTTP error: ${response.status}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML += `<p class="error">✗ Connection error: ${error.message}</p>`;
            }
        }
        
        async function testApi(port) {
            const resultDiv = document.getElementById(`result${port}`);
            resultDiv.innerHTML = `<p>Testing API POST to port ${port}...</p>`;
            
            try {
                const response = await fetch(`http://localhost:${port}/api/transcripts/process`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url: 'https://www.youtube.com/watch?v=test',
                        prompt: 'Test prompt',
                        duration: 10
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML += `<p class="success">✓ API call successful</p>`;
                    resultDiv.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    resultDiv.innerHTML += `<p class="error">✗ HTTP error: ${response.status}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML += `<p class="error">✗ API error: ${error.message}</p>`;
            }
        }
        
        function getNetworkInfo() {
            const infoDiv = document.getElementById('networkInfo');
            infoDiv.innerHTML = '<p>Browser information:</p>';
            infoDiv.innerHTML += `<p>User Agent: ${navigator.userAgent}</p>`;
            infoDiv.innerHTML += `<p>Online: ${navigator.onLine}</p>`;
            
            // Check if we're running on localhost
            infoDiv.innerHTML += `<p>Current URL: ${window.location.href}</p>`;
            
            // Test if we can access the common ports
            testPort(infoDiv, 5000);
            testPort(infoDiv, 5001);
            testPort(infoDiv, 3000);
        }
        
        function testPort(infoDiv, port) {
            const img = new Image();
            const startTime = new Date().getTime();
            
            img.onload = function() {
                const endTime = new Date().getTime();
                infoDiv.innerHTML += `<p class="success">✓ Port ${port} accessible (time: ${endTime - startTime}ms)</p>`;
            };
            
            img.onerror = function() {
                const endTime = new Date().getTime();
                // This will almost always error, but we can still check if it was a timeout or immediate
                if (endTime - startTime < 100) {
                    infoDiv.innerHTML += `<p class="error">✗ Port ${port} connection failed (time: ${endTime - startTime}ms)</p>`;
                } else {
                    infoDiv.innerHTML += `<p class="success">✓ Port ${port} attempted connection (time: ${endTime - startTime}ms)</p>`;
                }
            };
            
            img.src = `http://localhost:${port}/favicon.ico?t=${new Date().getTime()}`;
        }
    </script>
</body>
</html>
